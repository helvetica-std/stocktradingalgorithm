<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Trading Algorithm</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="container">
        <div class="logo">LOGO</div>
    </div>
    <div class="controls">
        <div class="control-group">
            <span id="fileSpan">+</span>
            <label>Upload</label>
        </div>
        <input type="file" id="uploadBtn">
        <div class="control-group">
            <div id="daysContainer">
                <input type="number" id="days" name="days" min="1" max="365" value="1">
            </div>
            <label>Days to Predict</label>
        </div>
        <div class="control-group">
            <button id="processBtn">SUBMIT</button>
        </div>
    </div>
    
    <script type="module">
    import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

    // Declare the chart dimensions and margins.
    const width = window.innerWidth * 0.7;
    const height = window.innerHeight * 0.5;
    const marginTop = 20;
    const marginRight = 20;
    const marginBottom = 30;
    const marginLeft = 40;

    // Load and parse CSV data
    let data = await d3.csv("predicted_vs_actual_validation.csv");
    
    // Parse dates and convert numeric values
    data = data.map(d => ({
        date: new Date(d.Date),
        actual: parseFloat(d.Actual_Price),
        predicted: parseFloat(d.Predicted_Price)
    }));

    // Declare the x (horizontal position) scale.
    const x = d3.scaleTime()
        .domain(d3.extent(data, d => d.date))
        .range([marginLeft, width - marginRight]);

    // Declare the y (vertical position) scale.
    const y = d3.scaleLinear()
        .domain([d3.min(data, d => Math.min(d.actual, d.predicted)) - 10, 
                 d3.max(data, d => Math.max(d.actual, d.predicted)) + 10])
        .range([height - marginBottom, marginTop]);

    // Create the SVG container.
    const svg = d3.create("svg")
        .attr("width", width)
        .attr("height", height)
        .style("border", "1px solid white")
        .style("padding", "2vw");

    // Add the x-axis.
    svg.append("g")
        .attr("class", "axis")
        .attr("transform", `translate(0,${height - marginBottom})`)
        .call(d3.axisBottom(x));

    // Add the y-axis.
    svg.append("g")
        .attr("class", "axis")
        .attr("transform", `translate(${marginLeft},0)`)
        .call(d3.axisLeft(y));

    // Line generator
    const line = d3.line()
        .x(d => x(d.date));

    // Draw actual price line
    svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 1.5)
        .attr("d", line.y(d => y(d.actual)));

    // Draw predicted price line
    svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "orange")
        .attr("stroke-width", 1.5)
        .attr("d", line.y(d => y(d.predicted)));

    // Append the SVG element.
    container.append(svg.node());

    </script>
</body>
</html>