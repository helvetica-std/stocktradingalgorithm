<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Trading Algorithm</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-wrapper">
                    <img src="logo.png" alt="Company Logo" class="logo-img">
                </div>
                <div class="header-text">
                    <h1>Stock Trading Algorithm</h1>
                    <p class="subtitle">AI-Powered Price Prediction</p>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="controls-card">
            <div class="controls">
                <div class="control-group">
                    <label for="days">Stock Ticker</label>
                    <div id="daysContainer">
                        <input type="text" id="days" name="days" placeholder="e.g., AAPL" value="" maxlength="5">
                    </div>
                </div>
                <div class="control-group">
                    <button id="processBtn" class="submit-btn">
                        <span>ANALYZE</span>
                        <span class="btn-icon">â†’</span>
                    </button>
                </div>
                <
            </div>
        </div>
    
    <div class="chart-container">
        <h3 class="chart-title">Next Month Price Prediction</h3>
        <div id="chart-wrapper"></div>
    </div>

    <div class="chart-container">
        <h3 class="chart-title">Predicted vs Actual Prices (Validation)</h3>
        <div id="validation-chart-wrapper"></div>
    </div>

    <div class="sentiment-container">
        <div class="sentiment-header">
            <h2>Sentiment Analysis</h2>
            <p id="sentiment-ticker" class="sentiment-ticker">Overall Market Sentiment</p>
        </div>
        <div class="sentiment-content">
            <div id="sentiment-chart-wrapper" class="sentiment-chart"></div>
            <div class="sentiment-stats">
                <div class="sentiment-stat positive">
                    <div class="stat-label">Positive</div>
                    <div class="stat-value" id="positive-pct">0%</div>
                </div>
                <div class="sentiment-stat neutral">
                    <div class="stat-label">Neutral</div>
                    <div class="stat-value" id="neutral-pct">0%</div>
                </div>
                <div class="sentiment-stat negative">
                    <div class="stat-label">Negative</div>
                    <div class="stat-value" id="negative-pct">0%</div>
                </div>
            </div>
        </div>
        <div id="top-articles" class="top-articles"></div>
    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
    const width = Math.min(window.innerWidth * 0.85, 1000);
    const height = window.innerHeight * 0.55;
    const marginTop = 20;
    const marginRight = 30;
    const marginBottom = 50;
    const marginLeft = 60;

    window.drawPredictionChart = function(chartData) {
        if (!chartData || chartData.length === 0) {
            console.log("No chart data available");
            return;
        }

        const parsedData = chartData.map((d) => ({
            day: parseInt(d.Day),
            predicted: parseFloat(d.Predicted_Price)
        }));

        const x = d3.scaleLinear()
            .domain(d3.extent(parsedData, d => d.day))
            .range([marginLeft, width - marginRight]);

        const y = d3.scaleLinear()
            .domain([d3.min(parsedData, d => d.predicted) - 5, 
                     d3.max(parsedData, d => d.predicted) + 5])
            .range([height - marginBottom, marginTop]);

        d3.select('#chart-wrapper').selectAll('*').remove();

        const svg = d3.create("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("viewBox", [0, 0, width, height])
            .style("background", "#0f172a")
            .style("border-radius", "12px")
            .style("box-shadow", "0 8px 32px rgba(0, 0, 0, 0.3)");

        svg.append("g")
            .attr("class", "grid")
            .attr("opacity", "0.1")
            .call(d3.axisLeft(y)
                .tickSize(-width + marginLeft + marginRight)
                .tickFormat("")
            );

        svg.append("g")
            .attr("class", "axis x-axis")
            .attr("transform", `translate(0,${height - marginBottom})`)
            .call(d3.axisBottom(x).ticks(6));

        svg.append("g")
            .attr("class", "axis y-axis")
            .attr("transform", `translate(${marginLeft},0)`)
            .call(d3.axisLeft(y).ticks(6));

        svg.append("text")
            .attr("class", "axis-label")
            .attr("x", width / 2)
            .attr("y", height - 5)
            .style("text-anchor", "middle")
            .style("fill", "#94a3b8")
            .style("font-size", "12px")
            .text("Trading Days");

        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("x", -height / 2)
            .attr("y", 15)
            .style("text-anchor", "middle")
            .style("fill", "#94a3b8")
            .style("font-size", "12px")
            .text("Price (USD)");

        const line = d3.line()
            .x(d => x(d.day))
            .y(d => y(d.predicted));

        svg.append("path")
            .datum(parsedData)
            .attr("fill", "none")
            .attr("stroke", "#f59e0b")
            .attr("stroke-width", 2.5)
            .attr("stroke-linecap", "round")
            .attr("stroke-linejoin", "round")
            .attr("d", line)
            .style("filter", "drop-shadow(0 0 4px rgba(245, 158, 11, 0.3))");

        const legendY = height - marginBottom + 40;
        const legendStartX = marginLeft;
        
        svg.append("circle")
            .attr("cx", legendStartX)
            .attr("cy", legendY)
            .attr("r", 5)
            .style("fill", "#f59e0b");
        
        svg.append("text")
            .attr("x", legendStartX + 15)
            .attr("y", legendY + 4)
            .style("fill", "#cbd5e1")
            .style("font-size", "13px")
            .style("font-weight", "500")
            .text("Predicted Price");

        document.getElementById('chart-wrapper').appendChild(svg.node());
    };

    window.drawValidationChart = function(validationData) {
        if (!validationData || validationData.length === 0) {
            console.log("No validation data available");
            return;
        }

        const parsedData = validationData.map((d) => ({
            date: new Date(d.Date),
            actual: parseFloat(d.Actual_Price),
            predicted: parseFloat(d.Predicted_Price)
        }));

        const x = d3.scaleTime()
            .domain(d3.extent(parsedData, d => d.date))
            .range([marginLeft, width - marginRight]);

        const y = d3.scaleLinear()
            .domain([
                d3.min(parsedData, d => Math.min(d.actual, d.predicted)) - 5,
                d3.max(parsedData, d => Math.max(d.actual, d.predicted)) + 5
            ])
            .range([height - marginBottom, marginTop]);

        d3.select('#validation-chart-wrapper').selectAll('*').remove();

        const svg = d3.create("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("viewBox", [0, 0, width, height])
            .style("background", "#0f172a")
            .style("border-radius", "12px")
            .style("box-shadow", "0 8px 32px rgba(0, 0, 0, 0.3)");

        svg.append("g")
            .attr("class", "grid")
            .attr("opacity", "0.1")
            .call(d3.axisLeft(y)
                .tickSize(-width + marginLeft + marginRight)
                .tickFormat("")
            );

        svg.append("g")
            .attr("class", "axis x-axis")
            .attr("transform", `translate(0,${height - marginBottom})`)
            .call(d3.axisBottom(x).ticks(6));

        svg.append("g")
            .attr("class", "axis y-axis")
            .attr("transform", `translate(${marginLeft},0)`)
            .call(d3.axisLeft(y).ticks(6));

        svg.append("text")
            .attr("class", "axis-label")
            .attr("x", width / 2)
            .attr("y", height - 5)
            .style("text-anchor", "middle")
            .style("fill", "#94a3b8")
            .style("font-size", "12px")
            .text("Date");

        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("x", -height / 2)
            .attr("y", 15)
            .style("text-anchor", "middle")
            .style("fill", "#94a3b8")
            .style("font-size", "12px")
            .text("Price (USD)");

        const line = d3.line()
            .x(d => x(d.date))
            .y(d => y(d.actual));

        const linePredicted = d3.line()
            .x(d => x(d.date))
            .y(d => y(d.predicted));

        svg.append("path")
            .datum(parsedData)
            .attr("fill", "none")
            .attr("stroke", "#10b981")
            .attr("stroke-width", 2.5)
            .attr("stroke-linecap", "round")
            .attr("stroke-linejoin", "round")
            .attr("d", line)
            .style("filter", "drop-shadow(0 0 4px rgba(16, 185, 129, 0.3))");

        svg.append("path")
            .datum(parsedData)
            .attr("fill", "none")
            .attr("stroke", "#3b82f6")
            .attr("stroke-width", 2.5)
            .attr("stroke-dasharray", "5,5")
            .attr("stroke-linecap", "round")
            .attr("stroke-linejoin", "round")
            .attr("d", linePredicted)
            .style("filter", "drop-shadow(0 0 4px rgba(59, 130, 246, 0.3))");

        const legendY = height - marginBottom + 40;
        const legendStartX = marginLeft;
        
        svg.append("circle")
            .attr("cx", legendStartX)
            .attr("cy", legendY)
            .attr("r", 5)
            .style("fill", "#10b981");
        
        svg.append("text")
            .attr("x", legendStartX + 15)
            .attr("y", legendY + 4)
            .style("fill", "#cbd5e1")
            .style("font-size", "13px")
            .style("font-weight", "500")
            .text("Actual Price");

        svg.append("circle")
            .attr("cx", legendStartX + 150)
            .attr("cy", legendY)
            .attr("r", 5)
            .style("fill", "#3b82f6");
        
        svg.append("text")
            .attr("x", legendStartX + 165)
            .attr("y", legendY + 4)
            .style("fill", "#cbd5e1")
            .style("font-size", "13px")
            .style("font-weight", "500")
            .text("Predicted Price");

        document.getElementById('validation-chart-wrapper').appendChild(svg.node());
    };

    window.drawSentimentChart = function(sentimentData) {
        if (!sentimentData || sentimentData.length === 0) {
            console.log("No sentiment data available");
            return;
        }

        const total = sentimentData.length;
        const positive = sentimentData.filter(a => a.sentiment === 'positive').length;
        const neutral = sentimentData.filter(a => a.sentiment === 'neutral').length;
        const negative = sentimentData.filter(a => a.sentiment === 'negative').length;

        const sentimentStats = {
            positive: Math.round((positive / total) * 100),
            neutral: Math.round((neutral / total) * 100),
            negative: Math.round((negative / total) * 100)
        };

        document.getElementById('positive-pct').textContent = sentimentStats.positive + '%';
        document.getElementById('neutral-pct').textContent = sentimentStats.neutral + '%';
        document.getElementById('negative-pct').textContent = sentimentStats.negative + '%';

        const pieData = [
            { label: 'Positive', value: sentimentStats.positive, color: '#10b981' },
            { label: 'Neutral', value: sentimentStats.neutral, color: '#6b7280' },
            { label: 'Negative', value: sentimentStats.negative, color: '#ef4444' }
        ];

        const pieWidth = Math.min(window.innerWidth * 0.35, 400);
        const pieHeight = 300;
        const pieRadius = Math.min(pieWidth, pieHeight) / 2 - 20;

        d3.select('#sentiment-chart-wrapper').selectAll('*').remove();

        const pieSvg = d3.create("svg")
            .attr("width", pieWidth)
            .attr("height", pieHeight)
            .attr("viewBox", [0, 0, pieWidth, pieHeight])
            .style("background", "#0f172a");

        const group = pieSvg.append("g")
            .attr("transform", `translate(${pieWidth / 2},${pieHeight / 2})`);

        const pie = d3.pie()
            .value(d => d.value)
            .sort(null);

        const arc = d3.arc()
            .innerRadius(0)
            .outerRadius(pieRadius);

        group.selectAll("path")
            .data(pie(pieData))
            .enter()
            .append("path")
            .attr("d", arc)
            .attr("fill", d => d.data.color)
            .attr("opacity", 0.85)
            .style("filter", "drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3))")
            .on("mouseover", function() {
                d3.select(this).attr("opacity", 1);
            })
            .on("mouseout", function() {
                d3.select(this).attr("opacity", 0.85);
            });

        group.selectAll("text")
            .data(pie(pieData))
            .enter()
            .append("text")
            .attr("transform", d => `translate(${arc.centroid(d)})`)
            .attr("text-anchor", "middle")
            .style("fill", "#f1f5f9")
            .style("font-size", "14px")
            .style("font-weight", "600")
            .text(d => `${d.data.value}%`);

        document.getElementById('sentiment-chart-wrapper').appendChild(pieSvg.node());

        const topArticles = sentimentData
            .sort((a, b) => b.positive_score - a.positive_score)
            .slice(0, 5);

        const articlesHtml = `
            <div class="articles-header">Top Articles</div>
            ${topArticles.map(article => `
                <div class="article-item sentiment-${article.sentiment}">
                    <div class="article-badge">${article.sentiment.toUpperCase()}</div>
                    <div class="article-info">
                        <div class="article-title">${article.title}</div>
                        <div class="article-source">${article.source}</div>
                    </div>
                </div>
            `).join('')}
        `;
        
        document.getElementById('top-articles').innerHTML = articlesHtml;
    };
    </script>
    <script src="script.js"></script>
</body>
</html>
